Example: Build a MySQL container with the following files:

# 1. Create the files.

## Puppetfile

Contains the [mysql module](https://forge.puppetlabs.com/puppetlabs/mysql) and it [dependencies](https://forge.puppetlabs.com/puppetlabs/mysql/dependencies).

```ruby
mod 'puppetlabs-mysql',
  :git => "git://github.com/puppetlabs/puppetlabs-mysql.git",
  :ref => "3.6.1"

mod 'puppetlabs-stdlib',
  :git => "https://github.com/puppetlabs/puppetlabs-stdlib",
  :ref => "4.9.0"

mod 'nanliu-staging',
  :git => "https://github.com/nanliu/puppet-staging",
  :ref => "1.0.4"
```

## Dockerfile

Based on the centos 6.6 image

```dockerfile
#Dockerfile autogenerated with crane
FROM cloudopting/centosbase:6.6

# Add puppet modules:
ADD modules /tmp/modules
# Add manifest to apply
ADD images/mysql3/manifest.pp /tmp/manifest.pp
# Apply manifest
RUN puppet apply --modulepath=/tmp/modules /tmp/manifest.pp
```

## Manifest (manifest.pp)

Taken from the [puppetlab-mysql repo](https://github.com/puppetlabs/puppetlabs-mysql/blob/master/examples/mysql_db.pp).

```ruby
class { 'mysql::server':
  root_password => 'password'
}
mysql::db { 'mydb':
  user     => 'myuser',
  password => 'mypass',
  host     => 'localhost',
  grant    => ['SELECT', 'UPDATE'],
}
mysql::db { "mydb_${fqdn}":
  user     => 'myuser',
  password => 'mypass',
  dbname   => 'mydb',
  host     => $::fqdn,
  grant    => ['SELECT', 'UPDATE'],
  tag      => $domain,
}
```

After creating all files you will have this filesystem tree:
```console
.
├── Dockerfile
├── manifest.pp
└── Puppetfile
```

# 2. Install modules and build the docker image.

To install the modules you have to follow this instructions.

Assuming you have ruby installed, you have to:
 1. Install 'r10k' with ``gem install r10k``
 2. Execute the command ``r10k puppetfile install``

Then the filesystem tree will look like the following sample and you are ready to go on:
```console
.
├── Dockerfile
├── manifest.pp
├── modules
│   ├── mysql
│   ├── staging
│   └── stdlib
└── Puppetfile
```

Then you will be able to create you image executing the following command:
```console
docker build .
```

# 3. The logs will be similar to the following

```
Step 1 : FROM cloudopting/centosbase:6.6
 ---> ba3d07e64e75
Step 2 : ADD modules /tmp/modules
 ---> d9628860dc1e
Removing intermediate container 022115981fec
Step 3 : ADD images/mysql3/manifest.pp /tmp/manifest.pp
 ---> d5b9df3560ba
Removing intermediate container 1f9f3fde4fae
Step 4 : RUN puppet apply --modulepath=/tmp/modules /tmp/manifest.pp
 ---> Running in fffe6d2099ef
Warning: Config file /etc/puppet/hiera.yaml not found, using Hiera defaults
Notice: Compiled catalog for 838a42ae8431.home in environment production in 1.45 seconds
Notice: /Stage[main]/Mysql::Server::Install/Package[mysql-server]/ensure: created
Notice: /Stage[main]/Mysql::Server::Config/File[mysql-config-file]/content: content changed '{md5}8ace886bbe7e274448bc8bea16d3ead6' to '{md5}d0d209eb5ed544658b3f1a72274bc3ed'
Notice: /Stage[main]/Mysql::Server::Config/File[/etc/my.cnf.d]/ensure: created
Notice: /Stage[main]/Mysql::Server::Installdb/Exec[mysql_install_db]/returns: executed successfully
Notice: /Stage[main]/Mysql::Server::Service/Service[mysqld]/ensure: ensure changed 'stopped' to 'running'
Notice: /Stage[main]/Mysql::Server::Root_password/Mysql_user[root@localhost]/password_hash: defined 'password_hash' as '*2470C0C06DEE42FD1618BB99005ADCA2EC9D1E19'
Notice: /Stage[main]/Mysql::Server::Root_password/File[/root/.my.cnf]/ensure: defined content as '{md5}6bf1a78e464837cf3c9782704c02de1f'
Notice: /Stage[main]/Main/Mysql::Db[mydb_838a42ae8431.home]/Mysql_user[myuser@838a42ae8431.home]/ensure: created
Notice: /Stage[main]/Main/Mysql::Db[mydb]/Mysql_user[myuser@localhost]/ensure: created
Notice: /Stage[main]/Main/Mysql::Db[mydb]/Mysql_database[mydb]/ensure: created
Notice: /Stage[main]/Main/Mysql::Db[mydb_838a42ae8431.home]/Mysql_grant[myuser@838a42ae8431.home/mydb.*]/ensure: created
Notice: /Stage[main]/Main/Mysql::Db[mydb]/Mysql_grant[myuser@localhost/mydb.*]/ensure: created
Notice: Finished catalog run in 44.79 seconds
 ---> 40180af857e3
Removing intermediate container fffe6d2099ef
Successfully built 40180af857e3
```
